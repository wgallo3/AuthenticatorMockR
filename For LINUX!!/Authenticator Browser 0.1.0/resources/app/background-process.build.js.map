{"version":3,"file":"background-process.build.js","sources":["app/env.js","app/background-process/api-manifests/sitedata.js","app/log.js","app/background-process/safe-storage/sitedata.js","app/background-process/safe-storage/settings.js","app/background-process/api-manifests/bookmarks.js","app/background-process/safe-storage/bookmarks.js","app/background-process/api-manifests/history.js","app/background-process/safe-storage/history.js","app/background-process/safe-storage/root-reducer.js","app/background-process/safe-storage/store.js","app/background-process/api-manifests/browser.js","app/background-process/plugins.js","app/background-process/browser.js","app/background-process/api-manifests/downloads.js","app/background-process/web-apis.js","app/background-process/ui/downloads.js","app/background-process/ui/permissions.js","app/background-process/ui/windows.js","app/background-process/ui/window-menu.js","app/background-process/ui/context-menu.js","app/background-process/protocols/beaker.js","app/background-process/protocols/beaker-favicon.js","app/background-process/open-url.js","app/background-process.js"],"sourcesContent":["// TODO - pull appropriately from build\n\nlet env = process.env.NODE_ENV || 'production'\n\nexport default {\n  name: env\n}","export default {\n  get: 'promise',\n  set: 'promise'\n}","import env from './env'\n\nexport default function log (...args) {\n  if (env.name !== 'production') {\n    console.log.apply(console, args)\n  }\n}","import { app, ipcMain } from 'electron'\nimport url from 'url'\nimport rpc from 'pauls-electron-rpc'\nimport manifest from '../api-manifests/sitedata'\nimport log from '../../log'\n\nimport store from './store'\nimport { createActions } from 'redux-actions'\nimport { List, Map, fromJS } from 'immutable'\n\n\n\n\nconst UPDATE_SITE_DATA = 'UPDATE_SITE_DATA'\n\nexport const { updateSiteData } = createActions( UPDATE_SITE_DATA )\n\nconst initialState = List([\n    Map( {\n        id: 'https:duckduckgo.com',\n        data : Map( {\n            favicon : `data:image/pngbase64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACkklEQVQ4T22SXUiTURjH/+ds2jTNPiTbXC1jbtAYaAh97cKBYlpWk+gDFhQUeOFFYBdCXqwQirqT6KKiDzTqIjIZpKG4YQsligLN3FzYcCWDPtaG7vuceN+Xzb3mA+fiff7P//c8530OwRoRtOn7QIhdJnHerx3wn11dTvITC7ZqJzjXcgIHAW4DRCvpPMiBDsLhACHB7QNzrVlfDhA4pl8E5yegUHpUpjokpt+tNRw4YxYQ8lw36FcLBSIg0FrtpDTVw1AwGdfXQFVvg6axDZSlETxT+x+IIrWPsYJunXOulbjqoawq1U9wQuuESra5ArsejstMIccFxD6+keUIZ+/no/795OsRwwAl5BEHfylUFN8bx8jbn7C3mURDdCmJ7z8iWNd5UA4AOc44PycAOMDDANkoVBTddSOFIiSTaeh15aKp/eoLdPlugkX+5EEkD/EfFgArEXE8gbl2D8KRGMo3rc8JoesnodKOoaRmGQs3NMj8VYga8a0ChOpPwXL5mrS8TBhsRpODhMdL8XtIHDQXxNsiv0KivBLmx2MSIBUCm63CvKMSLE6h2pkQT9i9QVClK3xprnZSsH4OxbMs1vjKm+vgbTGiUJ1EiSmGxGIhlj4XSaMjc5qB2sU1VqgMLgJYsq6yB26o1eI7gddWCx5flo0tTgd4QnGfVXxIM01GF2XozlB4xNV13cFgQR/OmzqRmv6ED8O9mDhQho7eBRGkYLAwip7dr70SQIipRmOUAIdA4AnvbcJT6zfEUnFQutL80q2A0NrCgWHziLdUukpeTDUYXcJncpvu/uyVo/0NO2zYWqxBdNKVDnRftIMo2wXdPOq1Zm0ygJAU/skWpWGIgzTI1gU++ivta7a6kc7P/wNyZ/k5PvUO0QAAAABJRU5ErkJggg==`\n        })\n    })\n]) \n\n\n\n\n\nexport default function sitedata(state = initialState, action) \n{\n    let payload = fromJS(  action.payload )\n    \n    switch (action.type) {\n        case UPDATE_SITE_DATA :\n        {            \n            let index = state.findIndex( site => {\n                \n                return site.get('id') === payload.get( 'id' )\n                \n            })\n            \n            if( index > -1 )\n            {\n                let siteToMerge = state.get( index )\n                let updatedSite = siteToMerge.mergeDeep( payload )\n                \n                return state.set( index, updatedSite )\n            }\n            \n            return state.push( payload )\n        }\n        return\n        default:\n        return state\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\nexport function setup () {    \n    // wire up RPC\n    rpc.exportAPI('beakerSitedata', manifest, { get, set })\n}\n\nexport function set (url, key, value)\n{\n    let origin = extractOrigin(url)    \n    let sitedata = { id: origin, data: {} }\n    \n    sitedata.data[ key ] = value\n        \n    return new Promise( ( resolve, reject) =>\n    {\n        return store.dispatch( updateSiteData( sitedata ) )\n        \n    })\n    \n    \n}\n\nexport function get (url, key) {\n    var origin = extractOrigin(url)\n    let sitedata = { id: origin, key: key }\n    \n    return new Promise( ( resolve, reject) =>\n    {\n        let site = store.getState()[ 'sitedata' ].find( site => site.get('id') === origin ) \n        \n        if( site )\n        {\n            let datum = site.get( 'data' ).get( key )\n            resolve( datum )\n        }\n        else {\n            resolve( undefined )\n        }\n        \n        \n    })\n}\n\nfunction extractOrigin (originURL) {\n    var urlp = url.parse(originURL)\n    if (!urlp || !urlp.host || !urlp.protocol)\n    return\n    return (urlp.protocol + urlp.host + (urlp.port || ''))\n}\n\n","import { app } from 'electron'\nimport log from '../../log'\nimport store, { handleAuthError } from './store'\nimport { List, Map, fromJS } from 'immutable'\n\nimport { createActions } from 'redux-actions'\nimport { auth } from 'safe-js'\n\nconst UPDATE_SETTINGS = 'UPDATE_SETTINGS'\n\nexport const { updateSettings } = createActions( UPDATE_SETTINGS )\n\n\nconst initialState = Map( {\n\tauto_update_enabled: 0,\n\tauthMessage : 'Not attempted to connect yet'\n})\n\nexport default function settings(state = initialState, action) \n{\n\tlet payload = fromJS( action.payload )\n\t\n\tswitch (action.type) {\n\t\tcase UPDATE_SETTINGS :\n\t\t{\n\t\t\treturn state.mergeDeep( payload )\n\t\t}\n\t\treturn\n\t\tdefault:\n\t\treturn state\n\t}\n}\n\n\n\n\n\n\n\n\n\nexport function set (key, value) \n{\n\treturn new Promise( (resolve, reject ) => \n\t{    \n\t\tlet setter = {}\n\t\tsetter[key] = value\n\t\tstore.dispatch( updateSettings( setter ) )\n\t})\n}\n\nexport function get (key) \n{\n\treturn new Promise( ( resolve, reject) =>\n\t{\n\t\tlet settings = store.getState()[ 'settings' ]\n\t\t\n\t\tif( settings )\n\t\t{\n\t\t\tlet result = settings.get( key )\n\t\t\tif( result )\n\t\t\t{\n\t\t\t\tresolve( settings.get( key ) )\n\t\t\t}\n\t\t\t\n\t\t}\n\t\telse {\n\t\t\tresolve( 'undefined' )\n\t\t}\n\t})\n\t\n}\n\n\nconst safeBrowserApp =\n{\n    //TODO: pull from package.json\n    name: \"SafeBrowser\",\n    id: \"safe-browser\",\n    version: \"0.4.0\",\n    vendor: \"josh.wilson\",\n    permissions : [ \"SAFE_DRIVE_ACCESS\"]\n}\n\n\n\nexport function reauthenticateSAFE () {\n\t\t\n\treturn auth.authorise( safeBrowserApp ).then( tok =>\n\t{\n\t\tstore.dispatch( updateSettings( { 'authSuccess': true } ) )\n\n\t\tstore.dispatch( updateSettings( { 'authToken' : tok.token } ) )\n\t\tstore.dispatch( updateSettings( { 'authMessage': 'Authorised with SAFE Launcher' } ) )\n\n\t} )\n\t// .catch( handleAuthError )\n}\n\nexport function getAll () {\n\treturn new Promise( ( resolve, reject) =>\n\t{\n\t\tlet settings = store.getState()[ 'settings' ]\n\t\t\n\t\tif( settings )\n\t\t{\n\t\t\tresolve( settings.toJS() )\n\t\t}\n\t\telse {\n\t\t\tresolve( {} )\n\t\t}\n\t})\n}\n","export default {\n  add: 'promise',\n  changeTitle: 'promise',\n  changeUrl: 'promise',\n  addVisit: 'promise',\n  remove: 'promise',\n  get: 'promise',\n  list: 'promise'\n}","import { app } from 'electron'\nimport url from 'url'\nimport rpc from 'pauls-electron-rpc'\nimport manifest from '../api-manifests/bookmarks'\nimport log from '../../log'\n\n\nimport store from './store'\nimport { List, Map, fromJS } from 'immutable'\nimport { createActions } from 'redux-actions'\n\nconst initialBookmarkState = List( [\n    Map( {\n        url: 'https://safenetforum.org/',\n        title : \"Safenet Forum\",\n        num_visits : 0\n    }),\n    Map( {\n        url: 'safe://dir.yvette/',\n        title : \"SAFE Network Directory\",\n        num_visits : 0\n    })\n] )\n\n\nconst UPDATE_BOOKMARK = 'UPDATE_BOOKMARK'\nconst DELETE_BOOKMARK = 'DELETE_BOOKMARK'\n\nexport const { updateBookmark, deleteBookmark } = createActions( UPDATE_BOOKMARK, DELETE_BOOKMARK )\n\nexport default function bookmarks(state = initialBookmarkState, action) {\n    let payload =  fromJS( action.payload ) \n    \n    if( action.error )\n    {\n        //trigger error action\n        return state\n    }\n\n    switch (action.type) {\n        case UPDATE_BOOKMARK :\n        {\n        \n            let newState\n            let newBookmarks\n            \n            let index = state.findIndex( site => {\n                return site.get('url') === payload.get( 'url' )\n            })\n            \n            if( index > -1 )\n            {\n                let siteToMerge = state.get( index )\n                let updatedSite = siteToMerge.mergeDeep( payload )\n\n                if( payload.get('newUrl') )\n                {\n                    updatedSite = updatedSite.set( 'url', payload.get('newUrl') )\n                }\n                \n                if( payload.get('num_visits') )\n                {\n                    let newVisitCount = siteToMerge.get('num_visits') || 0\n                    newVisitCount++\n                    updatedSite = updatedSite.set( 'num_visits', newVisitCount )\n                }\n                \n                return state.set( index, updatedSite )\n                \n            }\n            \n            if( payload.get( 'num_visits' ) )\n            {\n                return state\n            }\n            \n            return state.push( payload )\n        }\n        case DELETE_BOOKMARK: \n        {                         \n            let index = state.findIndex( site => site.get('url') === payload.get( 'url' ) )\n            \n            return state.delete( index )\n        } \n        default:\n            return state\n    }\n}\n\n\n\n\n\n\n\n\n\n\nexport function setup () {\n  // wire up RPC\n  rpc.exportAPI('beakerBookmarks', manifest, { add, changeTitle, changeUrl, addVisit, remove, get, list })\n}\n\nexport function add (url, title) {\n    return new Promise( (resolve, reject) =>\n    {\n        let bookmark = { url, title }        \n        return store.dispatch( updateBookmark( bookmark ) )\n    } ) \n\n}\n\nexport function changeTitle (url, title) {\n    \n    return new Promise( (resolve, reject) =>\n    {\n        let bookmark = { url, title }\n        \n        return store.dispatch( updateBookmark( bookmark ) )\n    } ) \n}\n\nexport function changeUrl (oldUrl, newUrl) {\n\n    return new Promise( (resolve, reject) =>\n    {\n        let bookmark = { \n            url: oldUrl,\n            newUrl : newUrl }\n        \n        return store.dispatch( updateBookmark( bookmark ) )\n    } ) \n\n}\n\nexport function addVisit (url) {\n    \n    let site = store.getState()[ 'bookmarks' ].find( site => site.get('url') === url ) \n    if( site )\n    {\n        return new Promise( (resolve, reject) =>\n        {\n            let bookmark = { url, num_visits : 1 }\n            \n            return store.dispatch( updateBookmark( bookmark ) )\n        } ) \n        \n    }\n    else {\n        return Promise.reject('bookmark does not exist')\n    }\n\n\n}\n\nexport function remove (url) {\n\n    return new Promise( (resolve, reject) =>\n    {\n        let bookmark = { url }\n        \n        return store.dispatch( deleteBookmark( bookmark ) )\n    } ) \n}\n\nexport function get (url) {\n\n    return new Promise( ( resolve, reject) =>\n    {\n        let site = store.getState()[ 'bookmarks' ].find( site => site.get('url') === url ) \n\n        if( site )\n        {\n            let datum = site.get( 'data' ).get( key )\n            resolve( datum )\n        }\n        else {\n            resolve( undefined )\n        }\n    })\n    \n}\n\nexport function list () {\n\n    let sites = store.getState()[ 'bookmarks' ].toJS()\n    \n    return new Promise( (resolve, reject ) => resolve( sites ))\n\n}\n","export default {\n  addVisit: 'promise',\n  getVisitHistory: 'promise',\n  getMostVisited: 'promise',\n  search: 'promise',\n  removeVisit: 'promise',\n  removeAllVisits: 'promise'\n}","import { app, ipcMain } from 'electron'\nimport url from 'url'\nimport zerr from 'zerr'\nimport rpc from 'pauls-electron-rpc'\nimport manifest from '../api-manifests/history'\nimport log from '../../log'\n\nimport store from './store'\nimport { List, Map, fromJS } from 'immutable'\nimport { createAction, createActions } from 'redux-actions'\n\nconst BadParam = zerr('BadParam', '% must be a %')\nconst InvalidCmd = zerr('InvalidCommand', '% is not a valid command')\n\n\nconst initialHistoryState = List( [\n    Map( {\n        url: 'https://safenetforum.org/',\n        title : \"Safenet Forum\",\n        visits: List([]), \n        last_visit: new Date()\n        \n    })\n] )\n\n\n\nconst UPDATE_SITE = 'UPDATE_SITE'\nconst DELETE_SITE = 'DELETE_SITE'\nconst DELETE_ALL  = 'DELETE_ALL'\n\nexport const { updateSite, deleteSite, deleteAll } = createActions( UPDATE_SITE, DELETE_SITE, DELETE_ALL )\n\nexport default function history(state = initialHistoryState, action) {\n    let payload = fromJS(  action.payload )\n    \n    if( action.error )\n    {\n        return state\n    }\n    \n    switch (action.type) {\n        case UPDATE_SITE :\n        {    \n            let index = state.findIndex( site => {\n                return site.get('url') === payload.get( 'url' )\n            })\n            \n            if( index > -1 )\n            {\n                let siteToMerge = state.get( index )\n                let updatedSite = siteToMerge.mergeDeep( payload ) //updates last visit, url, title\n                let lastVisit   = payload.get('last_visit')\n                // // beter parsing of things that will be always there\n                if( payload.get('last_visit') && ! updatedSite.get('visits').includes( lastVisit ) )\n                {\n                    let updatedSiteVisits = updatedSite.get( 'visits' ).push( lastVisit )\n                    updatedSite = updatedSite.set( 'visits', updatedSiteVisits )\n                }\n                \n                updatedSite = updatedSite.set( 'last_visit', payload.get('last_visit') )\n\n                return state.set( index, updatedSite )\n\n            }\n            \n            payload = payload.set( 'visits', List([ payload.get('last_visit') ] ))\n            \n            return state.push( payload )\n        }\n        case DELETE_SITE: \n            {                \n                let index = state.findIndex( site => site.get('url') === payload.get( 'url' ) )\n                \n                return state.delete( index )\n            } \n        \n        case DELETE_ALL: \n            { \n                return state.clear()    \n            }\n        default:\n          return state\n  }\n  \n  \n}\n\n\n\n\n\n\n\nexport function setup () {\n  // wire up RPC\n  rpc.exportAPI('beakerHistory', manifest, { addVisit, getVisitHistory, getMostVisited, search, removeVisit, removeAllVisits })\n}\n\nexport function addVisit ( {url, title } ) {\n    // each visit has a timestamp\n    return new Promise( (resolve, reject ) =>\n    {\n        let site = { url, title, last_visit: new Date() }        \n        return store.dispatch( updateSite( site ) )\n    })\n}\n\nexport function getVisitHistory ({ offset, limit }) {\n    \n    return new Promise( (resolve, reject ) =>\n    {\n        let history = store.getState()[ 'history' ]\n        \n        let filteredHistory = history.filter( (value, key) => \n        {            \n            return ( key >= offset && key <= limit  )\n        } )\n                \n        if( filteredHistory )\n        {\n            resolve( filteredHistory.toJS() )\n        }\n        else {\n            resolve( undefined )\n        }\n    })\n}\n\nexport function getMostVisited ({ offset, limit }) {\n    \n    offset  = offset || 0\n    limit   = limit || 50\n     \n    return getVisitHistory( { offset, limit } )\n            .then( unsortedHistory => \n            {                \n                unsortedHistory.sort(function(a, b) {\n                    return b.visits.length - a.visits.length //high->low ??\n                })\n                \n                return unsortedHistory\n            })\n}\n\nexport function search (q) \n{    \n    let history = store.getState()[ 'history' ].toJS()\n    \n    let filteredHistory = history.filter( (value, key) => \n    {\n        return ( value.url.includes( q ) || value.title.includes( q ) )\n    } )\n    \n    //sort mby most should be a helper function.\n    filteredHistory = filteredHistory.sort(function(a, b) {\n        if( !a.visits || !b.visits )\n        { \n            return 1\n        }\n        else \n        {\n            return b.visits.length - a.visits.length //high->low ??\n        }\n    })\n    \n    return new Promise( (resolve, reject ) =>\n    {\n        resolve( filteredHistory )\n    })\n}\n\nexport function removeVisit (url) {\n    return new Promise( (resolve, reject) =>\n    {\n        let site = { url }\n        \n        return store.dispatch( deleteSite( site ) )\n    } ) \n}\n\nexport function removeAllVisits () {\n    \n    \n    return new Promise( (resolve, reject) =>\n    {        \n        return store.dispatch( deleteAll() )\n    } ) \n}\n    ","import { combineReducers } from 'redux'\nimport settings from './settings'\nimport sitedata from './sitedata'\nimport bookmarks from './bookmarks'\nimport history from './history'\n\n\nconst rootReducer = combineReducers({\n    \n    bookmarks\n    , history\n    , settings\n    , sitedata\n})\n\nexport default rootReducer\n","import { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\nimport createNodeLogger from 'redux-node-logger'\nimport promiseMiddleware from 'redux-promise'\nimport _ from 'lodash'\n\nimport { updateSiteData } from './sitedata'\nimport { updateSettings } from './settings'\nimport { updateBookmark } from './bookmarks'\nimport { updateSite } from './history'\n\nimport rootReducer from './root-reducer'\nimport { nfs } from 'safe-js'\n\nexport const SITE_DATA_ID = 'safe:safe-browser'\nexport const SAFE_BROWSER_STATE_FILE = 'safeBrowserData.json'\n\n\nconst logger = createNodeLogger({\n    level: 'info',\n    collapsed: true\n})\n\nlet enhancer = compose(\n    applyMiddleware(thunk, logger, promiseMiddleware)\n)\n\nlet store = createStore(rootReducer, enhancer)\n\nexport default store;\n\n\n\nconst getTokenFromState = ( state = store.getState() ) =>\n{\n    let browserSettings = state[ 'settings' ]\n\n    if( browserSettings )\n    {\n        let authToken = browserSettings.get('authToken')\n                \n        if( authToken )\n        {\n            return authToken;\n            \n        }\n        else {\n            return null;\n        }\n        \n    }\n    else {\n        return null;\n    }\n}\n\n\nexport const getStore = ( token ) =>\n{\n    let currentToken = token || getTokenFromState()\n    \n    if( currentToken )\n    {\n        return nfs.getFile( currentToken, SAFE_BROWSER_STATE_FILE, 'json' )\n    }\n    else {\n        return Promise.reject( 'no token data found' )\n    }\n}\n\n\nconst save = ( ) =>\n{\n        let state = store.getState()\n        let currentToken = getTokenFromState( state )\n\n        if( currentToken )\n        {\n            let JSONToSave = JSON.stringify( state )\n            return nfs.createOrUpdateFile( currentToken, SAFE_BROWSER_STATE_FILE, JSONToSave, 'application/json' )\n                .then( bool => \n                    {\n                        console.log( \"success was had saving state:  \", bool )\n                        return bool\n                    } )\n        }\n        else {\n            return Promise.reject( new Error( 'Unable to save data to the SAFE network, as no token found' ) )\n        }\n}\n\nexport const saveStore = _.debounce( save, 500 );\n\n\n\n\n\nexport const reStore = ( storeState ) =>\n{\n    if( storeState.errorCode )\n    {\n        return Promise.reject( storeState )\n    }\n    \n    if( storeState.settings )\n    {\n        store.dispatch( updateSettings( storeState.settings ) )        \n\n    }\n    \n    if( storeState.sitedata )\n    {\n        dispatchForEach( storeState.sitedata , updateSiteData )\n    }\n    \n    if( storeState.history )\n    {\n        dispatchForEach( storeState.history , updateSite )\n    }\n    \n    if( storeState.bookmarks )\n    {\n        dispatchForEach( storeState.bookmarks , updateBookmark )\n    }\n    \n}\n\n\nconst dispatchForEach = ( array, action ) =>\n{\n    array.forEach( (item, key) => \n    {\n        store.dispatch( action( item ) )\n        return;\n    })\n}\n\n\n\n\n\nexport const handleAuthError = ( err ) =>\n{   \n    store.dispatch( updateSettings( { 'authSuccess': false} ) )\n    if( err.code === -12 )\n    {\n        store.dispatch( updateSettings( { 'authMessage': 'SAFE Launcher does not appear to be open.' } ) )\n        return\n    }\n    else if( err.code === 'ECONNREFUSED' )\n    {\n\t\tstore.dispatch( updateSettings( { 'authMessage': 'SAFE Launcher does not appear to be open.' } ) )\n        return\n    }\n    else if( err.statusText === 'Unauthorized' )\n    {\n\t\tstore.dispatch( updateSettings( { 'authMessage':'The browser failed to authorise with the SAFE launcher.' } ) )\n        return\n    }\n    \n    store.dispatch( updateSettings( { 'authMessage': '' + JSON.stringify( err ) } ) )\n}","export default {\n  eventsStream: 'readable',\n  getInfo: 'promise',\n  checkForUpdates: 'promise',\n  restartBrowser: 'sync',\n  reauthenticateSAFE: 'promise',\n\n  getSettings: 'promise',\n  getSetting: 'promise',\n  setSetting: 'promise',\n\n  listPlugins: 'promise',\n  lookupPlugin: 'promise',\n  installPlugin: 'promise',\n  uninstallPlugin: 'promise',\n\n  getHomePages: 'promise',\n  getProtocolDescription: 'sync',\n\n  getDefaultProtocolSettings: 'promise',\n  setAsDefaultProtocolClient: 'promise',\n  removeAsDefaultProtocolClient: 'promise'\n}\n","import { app, protocol } from 'electron'\nimport path from 'path'\nimport fs from 'fs'\nimport log from 'loglevel'\nimport rpc from 'pauls-electron-rpc'\nimport emitStream from 'emit-stream'\n\n// globals\n// =\nconst WITH_CALLBACK_TYPE_PREFIX = '_with_cb_';\n\nconst PLUGIN_NODE_MODULES = path.join(__dirname, 'node_modules')\nconsole.log('[PLUGINS] Loading from', PLUGIN_NODE_MODULES)\n\n// find all modules named beaker-plugin-*\nvar protocolModuleNames = []\ntry { protocolModuleNames = fs.readdirSync(PLUGIN_NODE_MODULES).filter(name => name.startsWith('beaker-plugin-')) }\ncatch (e) {}\n\n// load the plugin modules\nvar protocolModules = []\nvar protocolPackageJsons = {}\nprotocolModuleNames.forEach(name => {\n  // load module\n  try {\n    protocolModules.push(require(path.join(PLUGIN_NODE_MODULES, name)))\n  } catch (e) {\n    log.error('[PLUGINS] Failed to load plugin', name, e)\n    return\n  }\n\n  // load package.json\n  loadPackageJson(name)\n})\n\n// exported api\n// =\n\n// fetch a complete listing of the plugin info\n// - each plugin module can export arrays of values. this is a helper to create 1 list of all of them\nvar caches = {}\nexport function getAllInfo (key) {\n  // use cached\n  if (caches[key])\n    return caches[key]\n\n  // construct\n  caches[key] = []\n  protocolModules.forEach(protocolModule => {\n    if (!protocolModule[key])\n      return\n    // get the values from the module\n    var values = protocolModule[key]\n    if (!Array.isArray(values))\n      values = [values]\n\n    if (key === 'webAPIs') {\n      values = values.map(val => {\n        if (typeof val === 'object' && !val.scheme) {\n          val['scheme'] = protocolModule.protocols[0].scheme; // FIXME: for more than one scheme within plugin\n        }\n        return val;\n      });\n    }\n\n    // add to list\n    caches[key] = caches[key].concat(values)\n  })\n  return caches[key]\n}\n\n// register the protocols that have standard-url behaviors\n// - must be called before app 'ready'\nexport function registerStandardSchemes () {\n  var protos = getAllInfo('protocols')\n\n  // get the protocols that are 'standard'\n  var standardSchemes = protos.filter(desc => desc.isStandardURL).map(desc => desc.scheme)\n\n  // register\n  protocol.registerStandardSchemes(standardSchemes)\n}\n\n// register all protocol handlers\nexport function setupProtocolHandlers () {\n  getAllInfo('protocols').forEach(proto => {\n    // run the module's protocol setup\n    log.debug('Registering protocol handler:', proto.scheme)\n    proto.register()\n  })\n}\n\n// setup all web APIs\nexport function setupWebAPIs () {\n  getAllInfo('webAPIs').forEach(api => {\n    // run the module's protocol setup\n    log.debug('Wiring up Web API:', api.name)\n\n    // We export functions with callbacks in a separate channel\n    // since they will be adapted on the rederer side to invoke the callbacks\n    let fnsToExport = [];\n    let fnsWithCallbacks = [];\n    for (var fn in api.manifest) {\n      if (fn.startsWith(WITH_CALLBACK_TYPE_PREFIX)) {\n        fnsWithCallbacks[fn] = api.manifest[fn];\n      } else {\n        fnsToExport[fn] = api.manifest[fn];\n      }\n    }\n    rpc.exportAPI(api.name, fnsToExport, api.methods)\n    rpc.exportAPI(WITH_CALLBACK_TYPE_PREFIX + api.name, fnsWithCallbacks, api.methods) // FIXME: api.methods shall be probably chopped too\n  })\n}\n\n// get web API manifests for the given protocol\nexport function getWebAPIManifests (scheme) {\n  var manifests = {}\n\n  // massage input\n  scheme = scheme.replace(/:/g, '')\n\n  // get the protocol description\n  var proto = getAllInfo('protocols').find(proto => proto.scheme == scheme)\n  if (!proto)\n    return manifests\n\n  // collect manifests\n  getAllInfo('webAPIs').forEach(api => {\n    // just need to match isInternal for the api and the scheme\n    if ((api.isInternal == proto.isInternal) && (api.scheme === scheme))\n      manifests[api.name] = api.manifest\n  })\n  return manifests\n}\n\n// internal methods\n// =\n\nfunction loadPackageJson (name) {\n  var packageJson\n  try { packageJson = extractPackageJsonAttrs(require(path.join(PLUGIN_NODE_MODULES, name, 'package.json'))) }\n  catch (e) { packageJson = { name: name, status: 'installed' } }\n  protocolPackageJsons[name] = packageJson\n}\n\nfunction extractPackageJsonAttrs (packageJson) {\n  return {\n    name: packageJson.name,\n    author: packageJson.author,\n    description: packageJson.description,\n    homepage: packageJson.homepage,\n    version: packageJson.version,\n    status: 'installed'\n  }\n}\n","import { app, protocol, autoUpdater, session } from 'electron'\nimport os from 'os'\nimport rpc from 'pauls-electron-rpc'\nimport emitStream from 'emit-stream'\nimport EventEmitter from 'events'\nimport path from 'path'\nimport fs from 'fs'\nimport log from 'loglevel'\nimport globalModulesDir from 'global-modules'\nimport co from 'co'\nimport manifest from './api-manifests/browser'\nimport { cbPromise } from '../lib/functions'\nimport * as settingsDb from './safe-storage/settings'\nimport * as plugins from './plugins'\n\n// constants\n// =\n\n// how long between scheduled auto updates?\nconst SCHEDULED_AUTO_UPDATE_DELAY = 24 * 60 * 60 * 1e3 // once a day\n\n// possible updater states\nconst UPDATER_STATUS_IDLE = 'idle'\nconst UPDATER_STATUS_CHECKING = 'checking'\nconst UPDATER_STATUS_DOWNLOADING = 'downloading'\nconst UPDATER_STATUS_DOWNLOADED = 'downloaded'\n\n// globals\n// =\n\n// what's the updater doing?\nvar updaterState = UPDATER_STATUS_IDLE\nvar updaterError = false // has there been an error?\n\n// is the updater available? must be on certain platform, and may be disabled if there's an error\nvar isBrowserUpdatesSupported = (os.platform() == 'darwin' || os.platform() == 'win32')\n\n// events emitted to rpc clients\nvar browserEvents = new EventEmitter()\n\n// exported methods\n// =\n\nexport function setup () {\n  // setup auto-updater\n  try {\n    if (!isBrowserUpdatesSupported)\n      throw new Error('Disabled. Only available on macOS and Windows.')\n    autoUpdater.setFeedURL(getAutoUpdaterFeedURL())\n    autoUpdater.once('update-available', onUpdateAvailable)\n    autoUpdater.on('error', onUpdateError)\n  } catch (e) {\n    log.error('[AUTO-UPDATE]', e.toString())\n    isBrowserUpdatesSupported = false\n  }\n  setTimeout(scheduledAutoUpdate, 15e3) // wait 15s for first run\n\n  // wire up RPC\n  rpc.exportAPI('beakerBrowser', manifest, {\n    eventsStream,\n    getInfo,\n    checkForUpdates,\n    restartBrowser,\n    reauthenticateSAFE,\n    getSetting,\n    getSettings,\n    setSetting,\n\n    getProtocolDescription,\n    getHomePages,\n\n    getDefaultProtocolSettings,\n    setAsDefaultProtocolClient,\n    removeAsDefaultProtocolClient\n  })\n}\n\nexport function getDefaultProtocolSettings () {\n  return Promise.resolve(['http', 'dat', 'ipfs', 'view-dat'].reduce((res, x) => {\n    res[x] = app.isDefaultProtocolClient(x)\n    return res\n  }, {}))\n}\n\nexport function setAsDefaultProtocolClient (protocol) {\n  return Promise.resolve(app.setAsDefaultProtocolClient(protocol))\n}\n\nexport function removeAsDefaultProtocolClient (protocol) {\n  return Promise.resolve(app.removeAsDefaultProtocolClient(protocol))\n}\n\nexport function getInfo () {\n  return Promise.resolve({\n    version: app.getVersion(),\n    platform: os.platform(),\n    updater: {\n      isBrowserUpdatesSupported,\n      error: updaterError,\n      state: updaterState\n    },\n    paths: {\n      userData: app.getPath('userData')\n    }\n  })\n}\n\n// this method was written, as it is, when there was an in-app plugins installer\n// since it works well enough, and the in-app installer may return, Im leaving it this way\n// ... but, that would explain the somewhat odd design\n// -prf\nexport function checkForUpdates () {\n  // dont overlap\n  if (updaterState != UPDATER_STATUS_IDLE)\n    return\n\n  // track result states for this run\n  var isBrowserChecking = false // still checking?\n  var isBrowserUpdated = false  // got an update?\n\n  // update global state\n  log.debug('[AUTO-UPDATE] Checking for a new version.')\n  updaterError = false\n  setUpdaterState(UPDATER_STATUS_CHECKING)\n\n  if (isBrowserUpdatesSupported) {\n    // check the browser auto-updater\n    // - because we need to merge the electron auto-updater, and the npm plugin flow...\n    //   ... it's best to set the result events here\n    //   (see note above -- back when there WAS a plugin updater, this made since -prf)\n    isBrowserChecking = true\n    autoUpdater.checkForUpdates()\n    autoUpdater.once('update-not-available', () => {\n      log.debug('[AUTO-UPDATE] No browser update available.')\n      isBrowserChecking = false\n      checkDone()\n    })\n    autoUpdater.once('update-downloaded', () => {\n      log.debug('[AUTO-UPDATE] New browser version downloaded. Ready to install.')\n      isBrowserChecking = false\n      isBrowserUpdated = true\n      checkDone()\n    })\n\n    // cleanup\n    autoUpdater.once('update-not-available', removeAutoUpdaterListeners)\n    autoUpdater.once('update-downloaded', removeAutoUpdaterListeners)\n    function removeAutoUpdaterListeners () {\n      autoUpdater.removeAllListeners('update-not-available')\n      autoUpdater.removeAllListeners('update-downloaded')\n    }\n  }\n\n  // check the result states and emit accordingly\n  function checkDone () {\n    if (isBrowserChecking)\n      return // still checking\n\n    // done, emit based on result\n    if (isBrowserUpdated) {\n      setUpdaterState(UPDATER_STATUS_DOWNLOADED)\n    } else {\n      setUpdaterState(UPDATER_STATUS_IDLE)\n    }\n  }\n\n  // just return a resolve; results will be emitted\n  return Promise.resolve()\n}\n\nexport function restartBrowser () {\n  if (updaterState == UPDATER_STATUS_DOWNLOADED) {\n    // run the update installer\n    autoUpdater.quitAndInstall()\n    log.debug('[AUTO-UPDATE] Quitting and installing.')\n  } else {\n    log.debug('Restarting Beaker by restartBrowser()')\n    // do a simple restart\n    app.relaunch()\n    setTimeout(() => app.exit(0), 1e3)\n  }\n}\n\nexport function getSetting (key) {\n  return settingsDb.get(key)\n}\n\nexport function reauthenticateSAFE () {\n  return settingsDb.reauthenticateSAFE()\n}\n\nexport function getSettings () {\n  return settingsDb.getAll()\n}\n\nexport function setSetting (key, value) {\n  return settingsDb.set(key, value)\n}\n\n// get the home-page listing\nexport function getHomePages () {\n  return Promise.resolve(plugins.getAllInfo('homePages'))\n}\n\n// get the description for a given scheme\nexport function getProtocolDescription (scheme) {\n  // massage input\n  scheme = scheme.replace(/:/g, '')\n\n  // find desc\n  return plugins.getAllInfo('protocols').find(proto => proto.scheme == scheme)\n}\n\n// rpc methods\n// =\n\nfunction eventsStream () {\n  return emitStream(browserEvents)\n}\n\n// internal methods\n// =\n\nfunction setUpdaterState (state) {\n  updaterState = state\n  browserEvents.emit('updater-state-changed', state)\n}\n\nfunction getAutoUpdaterFeedURL () {\n  if (os.platform() == 'darwin') {\n    return 'https://download.beakerbrowser.net/update/osx/'+app.getVersion()\n  }\n  else if (os.platform() == 'win32') {\n    let bits = (os.arch().indexOf('64') === -1) ? 32 : 64\n    return 'https://download.beakerbrowser.net/update/win'+bits+'/'+app.getVersion()\n  }\n}\n\n// run a daily check for new updates\nfunction scheduledAutoUpdate () {\n  settingsDb.get('auto_update_enabled').then(v => {\n    // if auto updates are enabled, run the check\n    if (+v === 1)\n      checkForUpdates()\n\n    // schedule next check\n    setTimeout(scheduledAutoUpdate, SCHEDULED_AUTO_UPDATE_DELAY)\n  })\n}\n\n// event handlers\n// =\n\nfunction onUpdateAvailable () {\n  // update status and emit, so the frontend can update\n  log.debug('[AUTO-UPDATE] New version available. Downloading...')\n  setUpdaterState(UPDATER_STATUS_DOWNLOADING)\n}\n\nfunction onUpdateError (e) {\n  log.error('[AUTO-UPDATE]', e.toString())\n  setUpdaterState(UPDATER_STATUS_IDLE)\n  updaterError = e.toString()\n  browserEvents.emit('updater-error', e.toString())\n}\n","export default {\n  eventsStream: 'readable',\n  getDownloads: 'promise',\n  pause: 'promise',\n  resume: 'promise',\n  cancel: 'promise',\n  remove: 'promise',\n  open: 'promise',\n  showInFolder: 'promise'\n}","import { ipcMain } from 'electron'\nimport beakerBrowser from './api-manifests/browser'\nimport beakerBookmarks from './api-manifests/bookmarks'\nimport beakerDownloads from './api-manifests/downloads'\nimport beakerHistory from './api-manifests/history'\nimport beakerSitedata from './api-manifests/sitedata'\nimport * as plugins from './plugins'\n\n// dat-plugin is an optional internal dependency\nvar datPlugin\ntry {\n  datPlugin = require('beaker-plugin-dat')\n} catch (e){}\n\n// exported api\n// =\n\nexport function setup () {\n  // register a message-handler for setting up the client\n  // - see lib/fg/import-web-apis.js\n  ipcMain.on('get-web-api-manifests', (event, scheme) => {\n    // hardcode the beaker: scheme, since that's purely for internal use\n    if (scheme == 'beaker:') {\n      var protos = { \n        beakerBrowser,\n        beakerBookmarks,\n        beakerDownloads,\n        beakerHistory,\n        beakerSitedata\n      }\n      if (datPlugin && datPlugin.webAPIs[0])\n        protos.datInternalAPI = datPlugin.webAPIs[0].manifest\n      event.returnValue = protos\n      return\n    }\n\n    // for everything else, we'll use the plugins\n    event.returnValue = plugins.getWebAPIManifests(scheme)\n  })\n}","import path from 'path'\nimport fs from 'fs'\nimport { app, dialog, shell } from 'electron'\nimport unusedFilename from 'unused-filename'\nimport speedometer from 'speedometer'\nimport emitStream from 'emit-stream'\nimport EventEmitter from 'events'\nimport rpc from 'pauls-electron-rpc'\nimport manifest from '../api-manifests/downloads'\n\n// globals\n// =\n\n// downloads list\n// - shared across all windows\nvar downloads = []\n\n// used for rpc\nvar downloadsEvents = new EventEmitter()\n\n// exported api\n// =\n\nexport function setup () {\n  // wire up RPC\n  rpc.exportAPI('beakerDownloads', manifest, { eventsStream, getDownloads, pause, resume, cancel, remove, open, showInFolder })\n}\n\nexport function registerListener (win, opts = {}) {\n  const listener = (e, item, webContents) => {\n    // dont touch if already being handled\n    // - if `opts.saveAs` is being used, there may be multiple active event handlers\n    if (item.isHandled)\n      return\n\n    // build a path to an unused name in the downloads folder\n    const filePath = opts.saveAs ? opts.saveAs : unusedFilename.sync(path.join(app.getPath('downloads'), item.getFilename()))\n\n    // track as an active download\n    item.id = (''+Date.now())+(''+Math.random()) // pretty sure this is collision proof but replace if not -prf\n    item.name = path.basename(filePath)\n    item.setSavePath(filePath)\n    item.isHandled = true\n    item.downloadSpeed = speedometer()\n    downloads.push(item)\n    downloadsEvents.emit('new-download', toJSON(item))\n\n    // TODO: use mime type checking for file extension when no extension can be inferred\n    // item.getMimeType()\n\n    // update dock-icon progress bar\n    var lastBytes = 0\n    item.on('updated', () => {\n      var sumProgress = {\n        receivedBytes: getSumReceivedBytes(),\n        totalBytes: getSumTotalBytes()\n      }\n\n      // track rate of download\n      item.downloadSpeed(item.getReceivedBytes() - lastBytes)\n      lastBytes = item.getReceivedBytes()\n\n      // emit\n      downloadsEvents.emit('updated', toJSON(item))\n      downloadsEvents.emit('sum-progress', sumProgress)\n      win.setProgressBar(sumProgress.receivedBytes / sumProgress.totalBytes)\n    })\n\n    item.on('done', (e, state) => {\n      downloadsEvents.emit('done', toJSON(item))\n\n      // replace entry with a clone that captures the final state\n      downloads.splice(downloads.indexOf(item), 1, capture(item))\n\n      // reset progress bar when done\n      if (isNoActiveDownloads() && !win.isDestroyed()) {\n        win.setProgressBar(-1)\n      }\n\n      // inform users of error conditions\n      if (state === 'interrupted') {\n        dialog.showErrorBox('Download error', `The download of ${item.getFilename()} was interrupted`)\n      }\n\n      if (state === 'completed') {\n        // flash the dock on osx\n        if (process.platform === 'darwin') {\n          app.dock.downloadFinished(filePath)\n        }\n\n        // optional, for one-time downloads\n        if (opts.unregisterWhenDone) {\n          webContents.session.removeListener('will-download', listener)\n        }\n      }\n    })\n  }\n\n  win.webContents.session.prependListener('will-download', listener)\n  win.on('close', () => win.webContents.session.removeListener('will-download', listener))\n}\n\nexport function download (win, url, opts) {\n  // register for onetime use of the download system\n  opts = Object.assign({}, opts, {unregisterWhenDone: true})\n  registerListener(win, opts)\n  win.webContents.downloadURL(url)\n}\n\n// rpc api\n// =\n\nfunction eventsStream () {\n  return emitStream(downloadsEvents)\n}\n\nfunction getDownloads () {\n  return Promise.resolve(downloads.map(toJSON))\n}\n\nfunction pause (id) {\n  var download = downloads.find(d => d.id == id)\n  if (download)\n    download.pause()\n  return Promise.resolve()\n}\n\nfunction resume (id) {\n  var download = downloads.find(d => d.id == id)\n  if (download)\n    download.resume()\n  return Promise.resolve()\n}\n\nfunction cancel (id) {\n  var download = downloads.find(d => d.id == id)\n  if (download)\n    download.cancel()\n  return Promise.resolve()\n}\n\nfunction remove (id) {\n  var download = downloads.find(d => d.id == id)\n  if (download && download.getState() != 'progressing')\n    downloads.splice(downloads.indexOf(download), 1)\n  return Promise.resolve()\n}\n\nfunction open (id) {\n  return new Promise((resolve, reject) => {\n    // find the download\n    var download = downloads.find(d => d.id == id)\n    if (!download || download.state != 'completed')\n      return reject()\n\n    // make sure the file is still there\n    fs.stat(download.getSavePath(), err => {\n      if (err)\n        return reject()\n\n      // open\n      shell.openItem(download.getSavePath())\n      resolve()\n    })\n  })\n}\n\nfunction showInFolder (id) {\n  return new Promise((resolve, reject) => {\n    // find the download\n    var download = downloads.find(d => d.id == id)\n    if (!download || download.state != 'completed')\n      return reject()\n\n    // make sure the file is still there\n    fs.stat(download.getSavePath(), err => {\n      if (err)\n        return reject()\n\n      // open\n      shell.showItemInFolder(download.getSavePath())\n      resolve()\n    })\n  })\n}\n\n// internal helpers\n// =\n\n// reduce down to attributes\nfunction toJSON (item) {\n  return {\n    id: item.id,\n    name: item.name,\n    url: item.getURL(),\n    state: item.getState(),\n    isPaused: item.isPaused(),\n    receivedBytes: item.getReceivedBytes(),\n    totalBytes: item.getTotalBytes(),\n    downloadSpeed: item.downloadSpeed()\n  }\n}\n\n// create a capture of the final state of an item\nfunction capture (item) {\n  var savePath = item.getSavePath()\n  var dlspeed = item.download\n  item = toJSON(item)\n  item.getURL = () => item.url\n  item.getState = () => item.state\n  item.isPaused = () => false\n  item.getReceivedBytes = () => item.receivedBytes\n  item.getTotalBytes = () => item.totalBytes\n  item.getSavePath = () => savePath\n  item.downloadSpeed = () => dlspeed\n  return item\n}\n\n// sum of received bytes\nfunction getSumReceivedBytes () {\n  return getActiveDownloads().reduce((acc, item) => acc + item.getReceivedBytes(), 0) \n}\n\n// sum of total bytes\nfunction getSumTotalBytes () {\n  return getActiveDownloads().reduce((acc, item) => acc + item.getTotalBytes(), 0) \n}\n\nfunction getActiveDownloads () {\n  return downloads.filter(d => d.getState() == 'progressing')\n}\n\n// all downloads done?\nfunction isNoActiveDownloads () {\n  return getActiveDownloads().length === 0\n}","import { ipcMain, session, BrowserWindow } from 'electron'\nimport log from '../../log'\n\n// globals\n// =\n\nvar idCounter = 0\nvar activeRequests = []\n\n// exported api\n// =\n\nexport function setup () {\n  // wire up handlers\n  session.defaultSession.setPermissionRequestHandler(onPermissionRequestHandler)\n  ipcMain.on('permission-response', onPermissionResponseHandler)\n}\n\nexport function denyAllRequests (win) {\n  // remove all requests in the window, denying as we go \n  activeRequests = activeRequests.filter(req => {\n    if (req.win === win) {\n      log('Denying outstanding permission for closing window, req #'+req.id+' for '+req.permission)\n      req.cb(false)\n      return false\n    }\n    return true\n  })\n}\n\n// event handlers\n// =\n\nfunction onPermissionRequestHandler (webContents, permission, cb) {\n  // look up the containing window\n  var win = BrowserWindow.fromWebContents(webContents.hostWebContents)\n  if (!win)\n    return log('Warning: failed to find containing window of permission request, '+permission)\n\n  // if we're already tracking this kind of permission request, then bundle them\n  var req = activeRequests.find(req => req.win === win && req.permission === permission)\n  if (req) {\n    var oldCb = req.cb\n    req.cb = decision => { oldCb(decision); cb(decision) }\n  } else {\n    // track the new cb\n    var req = { id: ++idCounter, win, permission, cb }\n    activeRequests.push(req)\n  }\n\n  // send message to create the UI\n  win.webContents.send('command', 'perms:prompt', req.id, webContents.id, permission)\n}\n\nfunction onPermissionResponseHandler (e, reqId, decision) {\n  var win = e.sender\n\n  // lookup the cb\n  var req = activeRequests.find(req => req.id == reqId)\n  if (!req)\n    return log('Warning: failed to find permission request for response #'+reqId)\n\n  // untrack\n  activeRequests.splice(activeRequests.indexOf(req), 1)\n\n  // hand down the decision\n  var cb = req.cb\n  cb(decision)\n}","import { app, BrowserWindow, screen, ipcMain } from 'electron'\nimport { register as registerShortcut, unregisterAll as unregisterAllShortcuts } from 'electron-localshortcut'\nimport jetpack from 'fs-jetpack'\nimport path from 'path'\nimport * as downloads from './downloads'\nimport * as permissions from './permissions'\nimport log from '../../log'\nimport url from 'url'\nimport electronLocalshortcut from 'electron-localshortcut'\n\nimport store, { saveStore } from '../safe-storage/store'\n\n// globals\n// =\nvar userDataDir\nvar stateStoreFile = 'shell-window-state.json'\nvar numActiveWindows = 0\n\n// exported methods\n// =\n\nexport function setup () {\n  // config\n  userDataDir = jetpack.cwd(app.getPath('userData'))\n\n  // load pinned tabs\n  ipcMain.on('shell-window-ready', e => {\n    // if this is the first window opened (since app start or since all windows closing)\n    if (numActiveWindows === 1) {\n      e.sender.webContents.send('command', 'load-pinned-tabs')\n    }\n  })\n\n  // create first shell window\n  return createShellWindow()\n}\n\nexport function createShellWindow () {\n  // create window\n  var { x, y, width, height } = ensureVisibleOnSomeDisplay(restoreState())\n  var win = new BrowserWindow({ \n    titleBarStyle: 'hidden-inset',\n    'standard-window': false,\n    x, y, width, height,\n    webPreferences: {\n      webSecurity: false, // disable same-origin-policy in the shell window, webviews have it restored\n      allowRunningInsecureContent: false\n    }\n  })\n\n\n    //safe filter\n    let filter = {\n        urls: ['http://*/*', 'https://*/*' ]\n      \n    }\n    win.webContents.session.webRequest.onBeforeRequest(filter, (details, callback) => \n    {\n        const parsedUrl = url.parse(details.url)\n        \n        if( typeof(win.webContents.isSafe) === 'undefined' )\n        {\n            win.webContents.isSafe = true\n        }\n       \n        if( ! win.webContents.isSafe || parsedUrl.host.indexOf( 'localhost' ) === 0 )\n        {\n            callback({})\n            return\n        }\n            \n        if( details.url.indexOf('http') > -1 )\n        {\n          callback({ cancel: true })\n          \n        }\n    })\n    \n    //extra shortcuts outside of menus\n    electronLocalshortcut.register(win, 'Alt+D', () => \n    {\n        if (win) win.webContents.send('command', 'file:open-location')\n    })\n  \n    \n    store.subscribe( e => \n    {        \n        saveStore();    \n        win.webContents.send('safeStore-updated')\n\n    })\n\n  \n  \n  downloads.registerListener(win)\n  loadURL(win, 'beaker:shell-window')\n  numActiveWindows++\n\n  // register shortcuts\n  for (var i=1; i <= 9; i++)\n    registerShortcut(win, 'CmdOrCtrl+'+i, onTabSelect(win, i-1))\n  registerShortcut(win, 'Ctrl+Tab', onNextTab(win))\n  registerShortcut(win, 'Ctrl+Shift+Tab', onPrevTab(win))\n\n  // register event handlers\n  win.on('scroll-touch-begin', sendToWebContents('scroll-touch-begin'))\n  win.on('scroll-touch-end', sendToWebContents('scroll-touch-end'))\n  win.on('focus', sendToWebContents('focus'))\n  win.on('blur', sendToWebContents('blur'))\n  win.on('enter-full-screen', sendToWebContents('enter-full-screen'))\n  win.on('leave-full-screen', sendToWebContents('leave-full-screen'))\n  win.on('close', onClose(win))\n\n  return win\n}\n\n// internal methods\n// =\n\nfunction loadURL (win, url) {\n  win.loadURL(url)\n  log('Opening', url)  \n}\n\nfunction getCurrentPosition (win) {\n  var position = win.getPosition()\n  var size = win.getSize()\n  return {\n    x: position[0],\n    y: position[1],\n    width: size[0],\n    height: size[1]\n  }\n}\n\nfunction windowWithinBounds (windowState, bounds) {\n  return windowState.x >= bounds.x &&\n    windowState.y >= bounds.y &&\n    windowState.x + windowState.width <= bounds.x + bounds.width &&\n    windowState.y + windowState.height <= bounds.y + bounds.height\n}\n\nfunction restoreState () {\n  var restoredState = {}\n  try {\n    restoredState = userDataDir.read(stateStoreFile, 'json')\n  } catch (err) {\n    // For some reason json can't be read (might be corrupted).\n    // No worries, we have defaults.\n  }\n  return Object.assign({}, defaultState(), restoredState)\n}\n\nfunction defaultState () {\n  var bounds = screen.getPrimaryDisplay().bounds\n  var width = Math.max(800, Math.min(1800, bounds.width - 50))\n  var height = Math.max(600, Math.min(1200, bounds.height - 50))\n  return Object.assign({}, {\n    x: (bounds.width - width) / 2,\n    y: (bounds.height - height) / 2,\n    width,\n    height\n  })\n}\n\nfunction ensureVisibleOnSomeDisplay (windowState) {\n  var visible = screen.getAllDisplays().some(display => windowWithinBounds(windowState, display.bounds))\n  if (!visible) {\n    // Window is partially or fully not visible now.\n    // Reset it to safe defaults.\n    return defaultState(windowState)\n  }\n  return windowState\n}\n\nfunction onClose (win) {\n  return e => {\n    numActiveWindows--\n\n    // deny any outstanding permission requests\n    permissions.denyAllRequests(win)\n\n    // unregister shortcuts\n    unregisterAllShortcuts(win)\n\n    // save state\n    // NOTE this is called by .on('close')\n    // if quitting multiple windows at once, the final saved state is unpredictable\n    if (!win.isMinimized() && !win.isMaximized()) {\n      var state = getCurrentPosition(win)\n      userDataDir.write(stateStoreFile, state, { atomic: true })\n    }\n  }\n}\n\n// shortcut event handlers\n// =\n\nfunction onTabSelect (win, tabIndex) {\n  return () => win.webContents.send('command', 'set-tab', tabIndex)\n}\n\nfunction onNextTab (win) {\n  return () => win.webContents.send('command', 'window:next-tab')\n}\nfunction onPrevTab (win) {\n  return () => win.webContents.send('command', 'window:prev-tab')\n}\n\n// window event handlers\n// =\n\nfunction sendToWebContents (event) {\n  return e => e.sender.webContents.send('window-event', event)\n}","import { app, BrowserWindow, dialog } from 'electron'\nimport { createShellWindow } from './windows'\n\nvar darwinMenu = {\n  label: 'Beaker',\n  submenu: [\n    { label: 'About Beaker', role: 'about' },\n    { type: 'separator' },\n    { label: 'Services', role: 'services', submenu: [] },\n    { type: 'separator' },\n    { label: 'Hide Beaker', accelerator: 'Command+H', role: 'hide' },\n    { label: 'Hide Others', accelerator: 'Command+Alt+H', role: 'hideothers' },\n    { label: 'Show All', role: 'unhide' },\n    { type: 'separator' },\n    { label: 'Quit', accelerator: 'Command+Q', click() { app.quit() } }\n  ]\n}\n\nvar fileMenu = {\n  label: 'File',\n  submenu: [\n    {\n      label: 'New Tab',\n      accelerator: 'CmdOrCtrl+T',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'file:new-tab')\n      }\n    },\n    {\n      label: 'New Window',\n      accelerator: 'CmdOrCtrl+N',\n      click: function () { createShellWindow() }\n    },\n    {\n      label: 'Reopen Closed Tab',\n      accelerator: 'CmdOrCtrl+Shift+T',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'file:reopen-closed-tab')\n      }\n    },\n    {\n      label: 'Toggle SAFE Browsing',\n      checked: true,\n      accelerator: 'CmdOrCtrl+Shift+L',\n      click: function (item, win) {\n          if (win) win.webContents.send('command', 'window:toggle-safe-mode')\n      }\n    },\n    {\n      label: 'Open File',\n      accelerator: 'CmdOrCtrl+O',\n      click: function (item, win) {\n        if (win) {\n          dialog.showOpenDialog({ title: 'Open file...', properties: ['openFile', 'createDirectory'] }, files => {\n            if (files && files[0])\n              win.webContents.send('command', 'file:new-tab', 'file://'+files[0])\n          })\n        }\n      }\n    },\n    {\n      label: 'Open Location',\n      accelerator: 'CmdOrCtrl+L',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'file:open-location')\n      }\n    },\n    { type: 'separator' },\n    {\n      label: 'Close Window',\n      accelerator: 'CmdOrCtrl+Shift+W',\n      click: function (item, win) {\n        if (win) win.close()\n      }\n    },\n    {\n      label: 'Close Tab',\n      accelerator: 'CmdOrCtrl+W',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'file:close-tab')\n      }\n    }\n  ]\n}\n\nvar editMenu = {\n  label: 'Edit',\n  submenu: [\n    { label: \"Undo\", accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" },\n    { label: \"Redo\", accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" },\n    { type: \"separator\" },\n    { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n    { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n    { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n    { label: \"Select All\", accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" },\n    {\n      label: \"Find in Page\",\n      accelerator: \"CmdOrCtrl+F\",\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'edit:find')\n      }\n    }\n  ]\n}\n\nvar viewMenu = {\n  label: 'View',\n  submenu: [{\n    label: 'Reload',\n    accelerator: 'CmdOrCtrl+R',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:reload') \n    }\n  },\n  {\n    label: 'Hard Reload (Clear Cache)',\n    accelerator: 'CmdOrCtrl+Shift+R',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:hard-reload') \n    }\n  },\n  { type: \"separator\" },\n  {\n    label: 'Zoom In',\n    accelerator: 'CmdOrCtrl+=',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:zoom-in') \n    }\n  },\n  {\n    label: 'Zoom Out',\n    accelerator: 'CmdOrCtrl+-',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:zoom-out') \n    }\n  },\n  {\n    label: 'Actual Size',\n    accelerator: 'CmdOrCtrl+0',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:zoom-reset') \n    }\n  },\n  { type: \"separator\" },\n  {\n    label: 'Toggle DevTools',\n    accelerator: 'Alt+CmdOrCtrl+I',\n    click: function (item, win) {\n      if (win) win.webContents.send('command', 'view:toggle-dev-tools') \n    }\n  }]\n}\n\nvar historyMenu = {\n  label: 'History',\n  role: 'history',\n  submenu: [\n    {\n      label: 'Back',\n      accelerator: 'CmdOrCtrl+Left',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'history:back')\n      }\n    },\n    {\n      label: 'Forward',\n      accelerator: 'CmdOrCtrl+Right',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'history:forward')\n      }\n    }\n  ]\n}\n\nvar windowMenu = {\n  label: 'Window',\n  role: 'window',\n  submenu: [\n    {\n      label: 'Minimize',\n      accelerator: 'CmdOrCtrl+M',\n      role: 'minimize'\n    },\n    {\n      label: 'Close',\n      accelerator: 'CmdOrCtrl+Q',\n      role: 'close'\n    },\n    {\n      label: 'Next Tab',\n      accelerator: 'CmdOrCtrl+]',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'window:next-tab')\n      }\n    },\n    {\n      label: 'Previous Tab',\n      accelerator: 'CmdOrCtrl+[',\n      click: function (item, win) {\n        if (win) win.webContents.send('command', 'window:prev-tab')\n      }\n    }\n  ]\n}\nif (process.platform == 'darwin') {\n  windowMenu.submenu.push({\n    type: 'separator'\n  })\n  windowMenu.submenu.push({\n    label: 'Bring All to Front',\n    role: 'front'\n  })\n}\n\n\nvar beakerDevMenu = {\n  label: 'BeakerDev',\n  submenu: [{\n    label: 'Reload Shell-Window',\n    click: function () {\n      BrowserWindow.getFocusedWindow().webContents.reloadIgnoringCache()\n    }\n  },{\n    label: 'Toggle Shell-Window DevTools',\n    click: function () {\n      BrowserWindow.getFocusedWindow().toggleDevTools()\n    }\n  },{\n    label: 'Toggle WebSecurity for new tabs',\n    click: function ( item, win ) {\n        if (win) win.webContents.send('command', 'window:disable-web-security' )\n    }\n  }]\n}\n\nexport default function buildWindowMenu (env) {\n  var menus = [fileMenu, editMenu, viewMenu, historyMenu, windowMenu]\n  if (process.platform === 'darwin') menus.unshift(darwinMenu)\n  if (env.name !== 'production') menus.push(beakerDevMenu)\n  return menus\n}","import { app, Menu, clipboard, BrowserWindow, dialog } from 'electron'\nimport url from 'url'\nimport path from 'path'\nimport { download } from './downloads'\nimport { getProtocolDescription } from '../browser'\n\nexport default function registerContextMenu () {\n  // register the context menu on every created webContents\n  app.on('web-contents-created', (e, webContents) => {\n    webContents.on('context-menu', (e, props) => {\n      var menuItems = []\n      const { mediaFlags, editFlags } = props\n      const hasText = props.selectionText.trim().length > 0\n      const can = type => editFlags[`can${type}`] && hasText\n\n      // get the focused window, ignore if not available (not in focus)\n      // - fromWebContents(webContents) doesnt seem to work, maybe because webContents is often a webview?\n      var targetWindow = BrowserWindow.getFocusedWindow()\n      if (!targetWindow)\n        return\n\n      // ignore clicks on the shell window\n      if (props.pageURL == 'beaker:shell-window')\n        return\n\n      // helper to call code on the element under the cursor\n      const callOnElement = js => {\n        webContents.executeJavaScript(`\n          var el = document.elementFromPoint(${props.x}, ${props.y})\n          ${js}\n        `)\n      }\n\n      // helper to run a download prompt for media\n      const downloadPrompt = (item, win) => {\n        var defaultPath = path.join(app.getPath('downloads'), path.basename(props.srcURL))\n        dialog.showSaveDialog({ title: `Save ${props.mediaType} as...`, defaultPath }, filepath => {\n          if (filepath)\n            download(win, props.srcURL, { saveAs: filepath })\n        })\n      }\n\n      // links\n      if (props.linkURL && props.mediaType === 'none') {\n        menuItems.push({ label: 'Open Link in New Tab', click: (item, win) => win.webContents.send('command', 'file:new-tab', props.linkURL) })\n        menuItems.push({ label: 'Copy Link Address', click: () => clipboard.writeText(props.linkURL) })\n        menuItems.push({ type: 'separator' })\n      }\n\n      // images\n      if (props.mediaType == 'image') {\n        menuItems.push({ label: 'Save Image As...', click: downloadPrompt })\n        menuItems.push({ label: 'Copy Image', click: () => webContents.copyImageAt(props.x, props.y) })\n        menuItems.push({ label: 'Copy Image URL', click: () => clipboard.writeText(props.srcURL) })\n        menuItems.push({ label: 'Open Image in New Tab', click: (item, win) => win.webContents.send('command', 'file:new-tab', props.srcURL) })\n        menuItems.push({ type: 'separator' })\n      }\n\n      // videos and audios\n      if (props.mediaType == 'video' || props.mediaType == 'audio') {\n        menuItems.push({ label: 'Loop', type: 'checkbox', checked: mediaFlags.isLooping, click: () => callOnElement('el.loop = !el.loop') })\n        if (mediaFlags.hasAudio)\n          menuItems.push({ label: 'Muted', type: 'checkbox', checked: mediaFlags.isMuted, click: () => callOnElement('el.muted = !el.muted') })\n        if (mediaFlags.canToggleControls)\n          menuItems.push({ label: 'Show Controls', type: 'checkbox', checked: mediaFlags.isControlsVisible, click: () => callOnElement('el.controls = !el.controls') })\n        menuItems.push({ type: 'separator' })\n      }\n\n      // videos\n      if (props.mediaType == 'video') {\n        menuItems.push({ label: 'Save Video As...', click: downloadPrompt })\n        menuItems.push({ label: 'Copy Video URL', click: () => clipboard.writeText(props.srcURL) })\n        menuItems.push({ label: 'Open Video in New Tab', click: (item, win) => win.webContents.send('command', 'file:new-tab', props.srcURL) })\n        menuItems.push({ type: 'separator' })\n      }\n\n      // audios\n      if (props.mediaType == 'audio') {\n        menuItems.push({ label: 'Save Audio As...', click: downloadPrompt })\n        menuItems.push({ label: 'Copy Audio URL', click: () => clipboard.writeText(props.srcURL) })\n        menuItems.push({ label: 'Open Audio in New Tab', click: (item, win) => win.webContents.send('command', 'file:new-tab', props.srcURL) })\n        menuItems.push({ type: 'separator' })\n      }\n\n      // clipboard\n      if (props.isEditable) {\n        menuItems.push({ label: 'Cut', role: 'cut', enabled: can('Cut') })\n        menuItems.push({ label: 'Copy', role: 'copy', enabled: can('Copy') })\n        menuItems.push({ label: 'Paste', role: 'paste', enabled: editFlags.canPaste })\n        menuItems.push({ type: 'separator' })\n      }\n      else if (hasText) {\n        menuItems.push({ label: 'Copy', role: 'copy', enabled: can('Copy') })\n        menuItems.push({ type: 'separator' })      \n      }\n\n      // inspector\n      menuItems.push({ label: 'Inspect Element', click: item => {\n        webContents.inspectElement(props.x, props.y)\n        if (webContents.isDevToolsOpened())\n          webContents.devToolsWebContents.focus()\n      }})\n\n      // protocol\n      var urlp = url.parse(props.frameURL||props.pageURL)\n      var pdesc = getProtocolDescription(urlp.protocol)\n      if (pdesc && pdesc.contextMenu && Array.isArray(pdesc.contextMenu)) {\n        menuItems.push({ type: 'separator' })\n        pdesc.contextMenu.forEach(item => {\n          menuItems.push({\n            label: item.label,\n            click: (_, win) => item.click(win, props)\n          })\n        })\n      }\n\n      // show menu\n      var menu = Menu.buildFromTemplate(menuItems)\n      menu.popup(targetWindow)\n    })\n  })\n}","import { protocol, shell } from 'electron'\nimport path from 'path'\n\nexport function setup () {\n  protocol.registerFileProtocol('beaker', (request, cb) => {\n    // FIXME\n    // if-casing every possible asset is pretty dumb\n    // generalize this\n    // -prf\n\n    // browser ui\n    if (request.url == 'beaker:shell-window')\n      return cb(path.join(__dirname, 'shell-window.html'))\n    if (request.url == 'beaker:shell-window.js')\n      return cb(path.join(__dirname, 'shell-window.build.js'))\n    if (request.url == 'beaker:shell-window.css')\n      return cb(path.join(__dirname, 'stylesheets/shell-window.css'))\n\n    // builtin pages\n    for (let slug of ['start', 'favorites', 'archives', 'history', 'downloads', 'settings']) {\n      if (request.url == `beaker:${slug}`)\n        return cb(path.join(__dirname, 'builtin-pages.html'))\n    }\n    if (request.url.startsWith('beaker:site/'))\n      return cb(path.join(__dirname, 'builtin-pages.html'))\n    if (request.url == 'beaker:builtin-pages.js')\n      return cb(path.join(__dirname, 'builtin-pages.build.js'))\n    if (request.url == 'beaker:builtin-pages.css')\n      return cb(path.join(__dirname, 'stylesheets/builtin-pages.css'))\n\n    // common assets\n    if (request.url == 'beaker:font')\n      return cb(path.join(__dirname, 'fonts/photon-entypo.woff'))\n    if (request.url.startsWith('beaker:logo'))\n      return cb(path.join(__dirname, 'img/logo.png'))\n    if (request.url.startsWith('beaker:safe-auth-logo'))\n      return cb(path.join(__dirname, 'img/safe_auth_logo.svg'))\n    if (request.url.startsWith('beaker:safe-auth-home'))\n      return cb(shell.openExternal('safe-auth://home/'))\n\n    return cb(-6)\n  }, e => {\n    if (e)\n      console.error('Failed to register beaker protocol', e)\n  });\n}","/**\n * beaker-favicon:\n *\n * Helper protocol to serve site favicons from the sitedata db.\n **/\n\nimport { protocol } from 'electron'\nimport fs from 'fs'\nimport path from 'path'\nimport * as sitedata from '../safe-storage/sitedata'\n\nexport function setup () {\n  // load default favicon\n  var defaultFaviconBuffer = -6 // not found, till we load it\n  fs.readFile(path.join(__dirname, './img/default-favicon.ico'), (err, buf) => {\n    if (err)\n      console.log('Failed to load default favicon', path.join(__dirname, '../../img/default-favicon.ico'), err)\n    if (buf)\n      defaultFaviconBuffer = buf\n  })\n\n  // load logo favicon\n  var logoBuffer = -6 // not found, till we load it\n  fs.readFile(path.join(__dirname, './img/logo-favicon.png'), (err, buf) => {\n    if (err)\n      console.log('Failed to load logo favicon', path.join(__dirname, '../../img/logo.png'), err)\n    if (buf)\n      logoBuffer = buf\n  })\n\n  // register favicon protocol\n  protocol.registerBufferProtocol('beaker-favicon', (request, cb) => {\n    var url = request.url.slice('beaker-favicon:'.length)\n\n    // special case\n    if (url == 'beaker')\n      return cb(logoBuffer)\n\n    // look up in db\n    sitedata.get(url, 'favicon').then(data => {\n      if (data) {\n        // `data` is a data url ('data:image/png;base64,...')\n        // so, skip the beginning and pull out the data\n        data = data.split(',')[1]\n        if (data)\n          return cb(new Buffer(data, 'base64'))\n      }\n      cb(defaultFaviconBuffer)\n    }).catch(err => cb(defaultFaviconBuffer))\n  }, e => {\n    if (e)\n      console.error('Failed to register beaker-favicon protocol', e)\n  });\n}","// handle OSX open-url event\nimport { ipcMain } from 'electron'\nvar queue = []\nvar commandReceiver\n\nexport function setup () {\n  ipcMain.once('shell-window-ready', function (e) {\n    commandReceiver = e.sender\n    queue.forEach(url => commandReceiver.send('command', 'file:new-tab', url))\n    queue.length = 0\n  })\n}\n\nexport function open (url) {\n  if (commandReceiver) {\n    commandReceiver.send('command', 'file:new-tab', url)\n  } else {\n    queue.push(url)\n  }\n}\n","// This is main process of Electron, started as first thing when your\n// app starts. This script is running through entire life of your application.\n// It doesn't have any windows which you can see on screen, but we can open\n// window from here.\n\nimport { app, BrowserWindow, Menu } from 'electron'\nimport log from 'loglevel'\nimport env from './env'\n\nimport store, { getStore, reStore, saveStore, handleAuthError } from './background-process/safe-storage/store'\n\n// set setting does not trigger save\nimport { updateSettings } from './background-process/safe-storage/settings'\n\nimport * as beakerBrowser from './background-process/browser'\nimport * as plugins from './background-process/plugins'\nimport * as webAPIs from './background-process/web-apis'\nimport * as windows from './background-process/ui/windows'\nimport buildWindowMenu from './background-process/ui/window-menu'\nimport registerContextMenu from './background-process/ui/context-menu'\nimport * as downloads from './background-process/ui/downloads'\nimport * as permissions from './background-process/ui/permissions'\nimport * as settings from './background-process/safe-storage/settings'\nimport * as sitedata from './background-process/safe-storage/sitedata'\nimport * as bookmarks from './background-process/safe-storage/bookmarks'\nimport * as history from './background-process/safe-storage/history'\n\nimport * as beakerProtocol from './background-process/protocols/beaker'\nimport * as beakerFaviconProtocol from './background-process/protocols/beaker-favicon'\n\nimport * as openURL from './background-process/open-url'\n\nimport { auth } from 'safe-js'\n// import packageJson from './package.json'\nvar packageJson = require( './package.json' );\nvar mainWindow = null;\n\nconsole.log( \"packagejson\" );\n\nconst parseSafeUri = function(uri) {\n  return uri.replace('//', '').replace('==/', '==');\n};\n\nconst safeBrowserApp =\n{\n    name: packageJson.name,\n    id: packageJson.name,\n    version: packageJson.version,\n    vendor: packageJson.author.name,\n    permissions : [ \"SAFE_DRIVE_ACCESS\"]\n};\n\n\n\n\n// // configure logging\nlog.setLevel('trace')\n\n// load the installed protocols\nplugins.registerStandardSchemes()\n\napp.on('ready', function () {\n\n    let token = auth.authorise( safeBrowserApp ).then( tok =>\n  {\n        store.dispatch( updateSettings( { 'authSuccess': true } ) )\n        store.dispatch( updateSettings( { 'authToken' : tok.token } ) )\n        store.dispatch( updateSettings( { 'authMessage': 'Authorised with SAFE Launcher' } ) )\n\n        getStore( tok.token )\n            .then( json =>\n            {\n                reStore( json )\n\n            })\n            .catch( err =>\n            {\n                if( err.status === 404)\n                {\n                    store.dispatch( updateSettings( { 'authMessage': 'Authorised with SAFE Launcher'  } ) )\n                }\n                else {\n\n                    store.dispatch( updateSettings( { 'authMessage': 'Problems getting browser settings from the network, ' + err.staus + ', ' + err.statusText  } ) )\n                }\n            })\n\n  })\n  .catch( handleAuthError )\n\n  // API initialisations\n  sitedata.setup()\n  bookmarks.setup()\n  history.setup()\n\n  // base\n  beakerBrowser.setup()\n\n  // ui\n  Menu.setApplicationMenu(Menu.buildFromTemplate(buildWindowMenu(env)))\n  registerContextMenu()\n  windows.setup()\n  downloads.setup()\n  permissions.setup()\n\n  // protocols\n  beakerProtocol.setup()\n  beakerFaviconProtocol.setup()\n  plugins.setupProtocolHandlers()\n\n  // web APIs\n  webAPIs.setup()\n  plugins.setupWebAPIs()\n\n  // listen OSX open-url event\n  openURL.setup()\n\n  if((process.platform === 'linux') || (process.platform === 'win32')) {\n    if (process.argv[1] && (process.argv[1].indexOf('safe') !== -1)) {\n      openURL.open(parseSafeUri(process.argv[1]))\n    }\n  }\n\n  const shouldQuit = app.makeSingleInstance(function(commandLine, workingDirectory) {\n    if (commandLine.length >= 2 && commandLine[1]) {\n      openURL.open(parseSafeUri(commandLine[1]));\n    }\n\n    mainWindow = BrowserWindow.getFocusedWindow() || BrowserWindow.getAllWindows()[0]\n\n    // Someone tried to run a second instance, we should focus our window\n    if (mainWindow) {\n      if (mainWindow.isMinimized()) mainWindow.restore();\n      mainWindow.focus();\n    }\n  });\n\n  if (shouldQuit) {\n    app.quit();\n  }\n})\n\napp.on('window-all-closed', function () {\n  if (process.platform !== 'darwin')\n    app.quit()\n})\n\napp.on('open-url', function (e, url) {\n  openURL.open(url)\n})\n"],"names":["env","process","NODE_ENV","log","args","name","apply","console","UPDATE_SITE_DATA","updateSiteData","createActions","initialState","List","Map","sitedata","state","action","payload","fromJS","type","index","findIndex","site","get","siteToMerge","updatedSite","mergeDeep","set","push","setup","exportAPI","manifest","url","key","value","origin","extractOrigin","id","data","Promise","resolve","reject","store","dispatch","getState","find","datum","undefined","originURL","urlp","parse","host","protocol","port","UPDATE_SETTINGS","updateSettings","settings","setter","result","safeBrowserApp","reauthenticateSAFE","auth","authorise","then","tok","token","getAll","toJS","initialBookmarkState","UPDATE_BOOKMARK","DELETE_BOOKMARK","updateBookmark","deleteBookmark","bookmarks","error","newState","newBookmarks","newVisitCount","delete","add","changeTitle","changeUrl","addVisit","remove","list","title","bookmark","oldUrl","newUrl","num_visits","sites","BadParam","zerr","InvalidCmd","initialHistoryState","Date","UPDATE_SITE","DELETE_SITE","DELETE_ALL","updateSite","deleteSite","deleteAll","history","lastVisit","includes","updatedSiteVisits","clear","getVisitHistory","getMostVisited","search","removeVisit","removeAllVisits","last_visit","offset","limit","filteredHistory","filter","unsortedHistory","sort","a","b","visits","length","q","rootReducer","combineReducers","SAFE_BROWSER_STATE_FILE","logger","createNodeLogger","enhancer","compose","applyMiddleware","thunk","promiseMiddleware","createStore","getTokenFromState","browserSettings","authToken","getStore","currentToken","nfs","getFile","save","JSONToSave","JSON","stringify","createOrUpdateFile","bool","Error","saveStore","_","debounce","reStore","storeState","errorCode","dispatchForEach","array","forEach","item","handleAuthError","err","code","statusText","WITH_CALLBACK_TYPE_PREFIX","PLUGIN_NODE_MODULES","path","join","__dirname","protocolModuleNames","fs","readdirSync","startsWith","e","protocolModules","protocolPackageJsons","require","caches","getAllInfo","protocolModule","values","Array","isArray","map","val","scheme","protocols","concat","registerStandardSchemes","protos","standardSchemes","desc","isStandardURL","setupProtocolHandlers","proto","debug","register","setupWebAPIs","api","fnsToExport","fnsWithCallbacks","fn","methods","getWebAPIManifests","manifests","replace","isInternal","loadPackageJson","packageJson","extractPackageJsonAttrs","status","author","description","homepage","version","SCHEDULED_AUTO_UPDATE_DELAY","UPDATER_STATUS_IDLE","UPDATER_STATUS_CHECKING","UPDATER_STATUS_DOWNLOADING","UPDATER_STATUS_DOWNLOADED","updaterState","updaterError","isBrowserUpdatesSupported","os","platform","browserEvents","EventEmitter","setFeedURL","getAutoUpdaterFeedURL","once","onUpdateAvailable","on","onUpdateError","toString","scheduledAutoUpdate","getDefaultProtocolSettings","reduce","res","x","app","isDefaultProtocolClient","setAsDefaultProtocolClient","removeAsDefaultProtocolClient","getInfo","getVersion","getPath","checkForUpdates","isBrowserChecking","isBrowserUpdated","removeAutoUpdaterListeners","removeAllListeners","checkDone","restartBrowser","quitAndInstall","relaunch","exit","getSetting","settingsDb","getSettings","setSetting","getHomePages","plugins","getProtocolDescription","eventsStream","emitStream","setUpdaterState","emit","bits","arch","indexOf","v","datPlugin","event","webAPIs","datInternalAPI","returnValue","downloads","downloadsEvents","getDownloads","pause","resume","cancel","open","showInFolder","registerListener","win","opts","listener","webContents","isHandled","filePath","saveAs","unusedFilename","sync","getFilename","now","Math","random","basename","setSavePath","downloadSpeed","speedometer","toJSON","lastBytes","sumProgress","getSumReceivedBytes","getSumTotalBytes","getReceivedBytes","setProgressBar","receivedBytes","totalBytes","splice","capture","isNoActiveDownloads","isDestroyed","showErrorBox","dock","downloadFinished","unregisterWhenDone","session","removeListener","prependListener","download","Object","assign","downloadURL","d","stat","getSavePath","openItem","showItemInFolder","getURL","isPaused","getTotalBytes","savePath","dlspeed","getActiveDownloads","acc","idCounter","activeRequests","defaultSession","setPermissionRequestHandler","onPermissionRequestHandler","onPermissionResponseHandler","denyAllRequests","req","permission","cb","BrowserWindow","fromWebContents","hostWebContents","oldCb","decision","send","reqId","sender","userDataDir","stateStoreFile","numActiveWindows","jetpack","cwd","createShellWindow","y","width","height","ensureVisibleOnSomeDisplay","restoreState","webRequest","onBeforeRequest","details","callback","parsedUrl","isSafe","subscribe","i","registerShortcut","onTabSelect","onNextTab","onPrevTab","sendToWebContents","onClose","loadURL","getCurrentPosition","position","getPosition","size","getSize","windowWithinBounds","windowState","bounds","restoredState","read","defaultState","screen","getPrimaryDisplay","max","min","visible","getAllDisplays","some","display","isMinimized","isMaximized","write","atomic","tabIndex","darwinMenu","label","role","submenu","accelerator","click","quit","fileMenu","showOpenDialog","properties","files","close","editMenu","selector","viewMenu","historyMenu","windowMenu","beakerDevMenu","getFocusedWindow","reloadIgnoringCache","toggleDevTools","buildWindowMenu","menus","unshift","registerContextMenu","props","menuItems","mediaFlags","editFlags","hasText","selectionText","trim","can","targetWindow","pageURL","callOnElement","js","executeJavaScript","downloadPrompt","defaultPath","srcURL","showSaveDialog","mediaType","filepath","linkURL","clipboard","writeText","copyImageAt","checked","isLooping","hasAudio","isMuted","canToggleControls","isControlsVisible","isEditable","enabled","canPaste","inspectElement","isDevToolsOpened","devToolsWebContents","focus","frameURL","pdesc","contextMenu","menu","Menu","buildFromTemplate","popup","registerFileProtocol","request","slug","shell","openExternal","defaultFaviconBuffer","readFile","buf","logoBuffer","registerBufferProtocol","slice","split","Buffer","catch","queue","commandReceiver","mainWindow","parseSafeUri","uri","setLevel","json","staus","setApplicationMenu","argv","shouldQuit","makeSingleInstance","commandLine","workingDirectory","getAllWindows","restore"],"mappings":"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"}